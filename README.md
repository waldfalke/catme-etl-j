# Catме-ETL-j: High Volume Excel Converter

## Описание

**Catме-ETL-j (High Volume Excel Converter)** — это Java-утилита командной строки, предназначенная для высокопроизводительной и отказоустойчивой конвертации очень больших файлов Excel (формат `.xlsx`) в один из выбранных структурированных форматов: NDJSON (построчный JSON, рекомендуется), CSV (с возможностью разбивки на чанки) или простой JSON-массив.

Этот конвертер был разработан для решения проблем с ошибками `java.lang.OutOfMemoryError`, которые часто возникают при обработке `.xlsx` файлов размером >300MB стандартными пользовательскими моделями Apache POI. Он использует потоковую обработку на основе событийной модели Apache POI (XSSFReader + SAX) и ленивую загрузку разделяемых строк (Shared Strings Table) для минимизации потребления оперативной памяти.

## Ключевые особенности

*   **Обработка сверхбольших XLSX файлов:** Эффективно работает с файлами, значительно превышающими лимиты стандартных подходов (успешно протестировано на файлах ~700MB, рассчитано на многогигабайтные файлы).
*   **Потоковая обработка:** Использует событийную модель Apache POI (XSSFReader и SAX-парсер) для чтения и обработки данных "на лету".
*   **Низкое потребление памяти:** Применяет ленивую загрузку для таблицы разделяемых строк (`SharedStringsTable`) и избегает загрузки всего документа в память.
*   **Устойчивость к "Zip Bomb":** Настроены параметры `ZipSecureFile` для предотвращения атак типа "zip bomb" и корректной обработки файлов с аномально высоким коэффициентом сжатия внутренних XML-частей.
*   **Гибкие форматы вывода:** Поддерживает NDJSON (по умолчанию), CSV и JSON-массив.
*   **CLI-интерфейс:** Удобное управление через командную строку с использованием Picocli.
*   **Настраиваемый размер пакета (batch size):** Позволяет регулировать, как часто данные сбрасываются в выходной файл.
*   **Выбор листа:** Возможность указать лист для обработки по имени или индексу (по умолчанию обрабатывается первый лист).
*   **Определение строки заголовков:** Можно указать номер строки, содержащей заголовки.
*   **Перезапись выходного файла:** Опция для автоматической перезаписи существующего выходного файла.

## Предварительные требования

*   Java Development Kit (JDK) версии 17 или выше.
*   Apache Maven (для сборки проекта).

## Сборка проекта

1.  Клонируйте репозиторий (если вы еще этого не сделали):
    ```bash
    git clone https://github.com/waldfalke/catme-etl-j.git
    cd catme-etl-j
    ```
2.  Соберите проект с помощью Maven:
    ```bash
    mvn clean package
    ```
    Исполняемый JAR-файл будет создан в директории `target/` (например, `target/high-volume-excel-converter-2.0.1-SNAPSHOT.jar`).

## Использование (Командная строка)

Запустите конвертер из командной строки, используя собранный JAR-файл.

**Базовая команда:**
```bash
java -jar target/high-volume-excel-converter-VERSION-SNAPSHOT.jar [ОПЦИИ]
```
Замените `VERSION-SNAPSHOT` на актуальную версию из имени файла. Рекомендуется выделять достаточно памяти для Java-процесса (например, `-Xmx4g`).

**Основные опции:**

*   `-i, --input <filePath>`: **(Обязательно)** Путь к входному `.xlsx` файлу.
*   `-o, --output <filePath>`: **(Обязательно)** Путь к выходному файлу.
*   `-f, --format <NDJSON|CSV|JSON>`: Формат вывода. По умолчанию: `NDJSON`.
*   `--sheetName <sheetName>`: Имя листа Excel для обработки.
*   `--sheetIndex <sheetIndex>`: Индекс листа Excel для обработки (начиная с 0). Если не указано ни имя, ни индекс, используется первый лист.
*   `--headerRow <rowIndex>`: Номер строки (начиная с 0), содержащей заголовки. По умолчанию: `0`.
*   `-b, --batchSize <numberOfRecords>`: Количество записей, обрабатываемых за один "проход" перед сбросом на диск. По умолчанию: `50000`.
*   `--overwrite`: Если указано, существующий выходной файл будет перезаписан без предупреждения.
*   `--help`: Показать полное справочное сообщение со всеми опциями.

**Пример:**
```bash
java -Xmx4g -jar target/high-volume-excel-converter-2.0.1-SNAPSHOT.jar \
    --input "/path/to/your/large_excel_file.xlsx" \
    --output "/path/to/your/output_file.ndjson" \
    --format NDJSON \
    --overwrite
```

## Технический стек

*   **Java 17**
*   **Apache POI (5.x.x):** Для работы с форматом XLSX (XSSFReader, SAX).
*   **Picocli:** Для парсинга аргументов командной строки.
*   **Jackson Databind:** Для генерации JSON/NDJSON.
*   **Apache Commons CSV:** Для генерации CSV.
*   **Logback (через SLF4J):** Для логирования.
*   **Maven:** Для сборки проекта.

## Контракт и детальная спецификация

Более подробную информацию об архитектуре, предусловиях, постусловиях и инвариантах модуля можно найти в документе:
[HighVolumeExcelConverter-Contract-v2.0.1.md](HighVolumeExcelConverter-Contract-v2.0.1.md)

## Лицензия

[Будет добавлена позже. Выберите подходящую лицензию для вашего проекта, например, MIT, Apache 2.0, и т.д.]

## Вклад в проект (Contributing)

Предложения и Pull Request'ы приветствуются. Для серьезных изменений, пожалуйста, сначала откройте Issue для обсуждения того, что вы хотели бы изменить.

---

_Этот README.md сгенерирован и может быть дополнен._ 